#!/bin/sh

url="http://Nicolas.Thiery.name/Enseignement/Info111/"

help () {
    cat <<EOF

Aide pour l'utilisation de la commande info-111
==============================================

Télécharger et extraire l'archive pour un TP ou un projet (ici pour la semaine 1):

       cd ~/Info111
       info-111 get Semaine1

Lancer le notebook jupyter:

       info-111 jupyter notebook

Compiler un programme (ici essai.cpp):

       info-111 g++ essai.cpp -o essai

EOF
}

run () {
    echo "Exécution de: $@"
    "$@" || exit 1
}

get () {
    if [ `pwd` != "$HOME/Info111" ]; then
        echo Vous devez être dans le sous-répertoire Info111 de votre répertoire pour lancer cette commande
        exit 1
    fi
    archive=$1
    run wget "$url/$archive.zip"
    run unzip "$archive.zip"
    run rm "$archive.zip"
    exit 0
}

command=$1
if [ -z $command ]; then
    help;
    exit 0
fi

shift || help

case $command in
    help)
        help
        exit 0;;
    g++)
        command="g++ -Wall -pedantic";;
    jupyter)
        if [ "$1" = "notebook" ]; then
            shift
            command="jupyter notebook --ip=127.0.0.1"
        fi;;
    get)
        get "$@";;
    run) # run an arbitrary command in the conda environment; for testing and teacher's use
        command="$1"
        shift;;
    *)
        echo commande info-111 $command inconnue
        help
        exit 1
        ;;
esac

run $command "$@"
